{% extends "base.html" %}

{% block title %}菜單 - 餐飲點餐系統{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <h1 class="text-center mb-4">美食菜單</h1>
        <p class="text-center text-muted">選擇您喜歡的美食，點擊加入購物車</p>
    </div>
</div>

<div class="row" id="menu-items">
    {% for product in products %}
    <div class="col-md-4 col-lg-3 mb-4">
        <div class="card h-100 shadow-sm">
            <img src="{{ product.image_url }}" class="card-img-top" alt="{{ product.name }}">
            <div class="card-body d-flex flex-column">
                <h5 class="card-title">{{ product.name }}</h5>
                <p class="card-text text-muted small">{{ product.category }}</p>
                <p class="card-text"><strong class="text-primary fs-5">NT$ {{ product.price }}</strong></p>
                <div class="mt-auto">
                    <button class="btn btn-primary w-100 add-to-cart-btn" 
                            data-id="{{ product.id }}" 
                            data-name="{{ product.name }}" 
                            data-price="{{ product.price }}">
                        <i class="fas fa-plus me-1"></i>加入購物車
                    </button>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}

{% block scripts %}
<script>
document.querySelectorAll('.add-to-cart-btn').forEach(button => {
    button.addEventListener('click', function() {
        const productId = this.dataset.id;
        const productName = this.dataset.name;
        
        fetch('/api/add_to_cart', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                product_id: parseInt(productId),
                quantity: 1
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // 顯示成功訊息
                const originalText = this.innerHTML;
                this.innerHTML = '<i class="fas fa-check me-1"></i>已加入';
                this.classList.remove('btn-primary');
                this.classList.add('btn-success');
                
                setTimeout(() => {
                    this.innerHTML = originalText;
                    this.classList.remove('btn-success');
                    this.classList.add('btn-primary');
                }, 1000);
                
                updateCartCount();
            } else {
                alert('加入購物車失敗：' + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('發生錯誤，請稍後再試');
        });
    });
});
</script>
{% endblock %}